<%- include('../wrapper/header') %>

<aside
  class="bg-gray-200 w-40 max-md:w-20 h-screen p-5 fixed inset-y-0 left-0 transform -translate-x-full transition-transform duration-300 md:translate-x-0 z-20"
  id="sidebar"
>
  <div class="flex justify-center mb-5">
    <img src="/logo.png" class="h-10 w-10 md:h-24 md:w-24" alt="blogs" />
  </div>
  <nav>
    <ul class="space-y-4">
      <li>
        <a
          href="/admin/dashboard"
          class="mb-4 flex gap-x-2 items-center text-blue-900 hover:text-blue-500"
        >
          <img src="/users.svg" class="h-7 w-7" alt="users" />
          <span class="font-semibold text-md text-gray-500 hidden md:block"
            >Users</span
          >
        </a>
      </li>
      <li>
        <a
          href="/admin/dashboard/blogs"
          class="gap-x-2 flex items-center text-blue-900 hover:text-blue-500"
        >
          <img src="/blogs.svg" class="h-7 w-7" alt="blogs" />
          <span class="font-semibold text-md text-gray-500 hidden md:block"
            >Blogs</span
          >
        </a>
      </li>
      <li>
        <a
          href="/admin/dashboard/forums"
          class="gap-x-2 flex items-center text-blue-900 hover:text-blue-500 w-32 max-md:w-10 px-3 py-2 rounded-lg"
        >
          <img src="/forum.svg" class="h-7 w-7" alt="blogs" />
          <span class="font-semibold text-md text-gray-500 hidden md:block"
            >Forums</span
          >
        </a>
      </li>
      <li>
        <a
          href="/admin/career"
          class="gap-x-2 flex items-center text-blue-900 hover:text-blue-500 w-32 max-md:w-10 px-3 py-2 rounded-lg"
        >
          <img src="/career.svg" class="h-7 w-7" alt="blogs" />
          <span class="font-semibold text-md text-gray-500 hidden md:block"
            >Career</span
          >
        </a>
      </li>
      <li>
        <a
          href="/admin/services"
          class="gap-x-2 flex items-center text-blue-900 hover:text-blue-500 w-32 max-md:w-10 px-3 py-2 rounded-lg"
        >
          <img src="/career.svg" class="h-7 w-7" alt="blogs" />
          <span class="font-semibold text-md text-gray-500 hidden md:block"
            >Services</span
          >
        </a>
      </li>
      <li>
        <a
          href="/admin/menu"
          class="gap-x-2 flex items-center text-blue-900 hover:text-blue-500 w-32 px-3 py-2 rounded-lg"
        >
          <img src="/menu.svg" class="h-7 w-7" alt="blogs" />
          <span class="font-semibold text-md text-gray-500 hidden md:block"
            >Menu</span
          >
        </a>
      </li>
      <li>
        <a
          href="/admin/import"
          class="gap-x-2 flex items-center text-blue-900 hover:text-blue-500 bg-gray-300 max-md:bg-none px-3 py-2 rounded-lg"
        >
          <img src="/import.svg" class="h-7 w-7" alt="import" />
          <span class="font-semibold text-md text-gray-500 hidden md:block"
            >Import</span
          >
        </a>
      </li>

      <li>
        <a
          href="/admin/settings"
          class="gap-x-2 flex items-center text-blue-900 hover:text-blue-500  max-md:bg-none px-3 py-2 rounded-lg"
        >
          <img src="/settings.svg" class="h-7 w-7" alt="settings" />
          <span class="font-semibold text-md text-gray-500 hidden md:block"
            >Settings</span
          >
        </a>
      </li>
    </ul>
  </nav>
</aside>

<h1 class="ms-[14rem] my-3 text-4xl font-bold"><%= title %></h1>

<div
  class="flex flex-wrap justify-evenly items-center md:flex-row-reverse max-md:flex-col-reverse"
>
  <!-- Import Data Modal -->
  <div class="modal route-form-modal z-10 bg-opacity-50" id="form">
    <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-sm">
      <h2 id="modal-title" class="text-2xl font-semibold mb-4">Import Data</h2>

      <form
        id="route-form"
        class="grid grid-cols-2 gap-4"
        enctype="multipart/form-data"
      >
        <div class="col-span-2">
          <p class="text-gray-600 mb-2">Website Link</p>
          <input
            type="url"
            id="domain"
            required
            minlength="3"
            class="w-full px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="Website Link"
          />
          <p class="text-red-600 mt-1" id="domainError"></p>
        </div>

        <div class="col-span-2">
          <p class="text-gray-600 mb-2">Module</p>
          <select
            id="module"
            class="w-full px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            required
          >
            <option selected value="blogs">Blogs</option>
            <option value="career">Career</option>
            <option value="services">Services</option>
            <option value="forums">Forums</option>
          </select>
        </div>

        <div>
          <p class="text-gray-600 mb-2">StartID</p>
          <input
            type="text"
            id="startID"
            class="w-full px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="StartID"
          />
        </div>

        <div>
          <p class="text-gray-600 mb-2">Count</p>
          <input
            type="number"
            id="count"
            class="w-full px-4 py-2 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
            placeholder="Count"
          />
        </div>
      </form>

      <div class="flex justify-end gap-4 mt-6">
        <button
          id="submit"
          class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
        >
          Fetch
        </button>
      </div>
    </div>
  </div>
</div>

<div
  id="loader"
  class="hidden fixed top-[50%] left-[50%] translate-x-[-50%] translate-y-[-50%]"
>
  <img src="/mobile.gif" class="w-full h-fit" alt="" />
</div>
<div
  id="lastdata"
  class="fixed top-5 right-5 bg-cyan-600 flex items-center text-white rounded-lg py-2 px-3 gap-x-5"
>
  <img src="/task.svg" class="h-7 w-7" alt="error" />
  <p id="lastdata-id">Last Entered ID: <%= id %></p>
</div>
<div
  id="warning-msg"
  class="fixed top-5 right-5 bg-yellow-500 flex items-center hidden text-white rounded-lg py-2 px-3 gap-x-5"
>
  <img src="/warning.svg" class="h-7 w-7" alt="error" />
  <p>Please Do Not Refresh The Page</p>
</div>
<div
  id="success"
  class="modal route-form-modal fixed bottom-10 right-5 z-10 bg-opacity-50 hidden"
>
  <div
    class="bg-green-600 text-white rounded-lg shadow-lg flex items-center gap-x-3 px-6 py-3 w-full max-w-sm"
  >
    <img src="/success.svg" class="h-7 w-7" alt="" />
    <p id="success-msg" class="text-sm font-semibold">
      Query Run Successfully, 0 Rows Affected
    </p>
  </div>
</div>

<div
  id="error"
  class="modal route-form-modal fixed bottom-10 right-5 z-10 bg-opacity-50 hidden"
>
  <div
    class="bg-red-600 text-white rounded-lg shadow-lg w-full flex items-center px-6 py-3 gap-x-3 max-w-sm"
  >
    <img src="/error.svg" class="h-7 w-7" alt="" />
    <p id="error-msg" class="text-sm font-semibold">
      Query Run Failed, Something Went Wrong!
    </p>
  </div>
</div>

<script>
  document.getElementById("submit").addEventListener("click", async () => {
    const domain = document.getElementById("domain").value;
    const module = document.getElementById("module").value;
    const count = document.getElementById("count").value;
    const startID = document.getElementById("startID").value;

    console.log({ domain, module, count, startID });
    document.getElementById("form").classList.add("hidden");
    document.getElementById("loader").classList.remove("hidden");
    document.getElementById("warning-msg").classList.remove("hidden");
    try {
      const response = await fetch(
        `${window.location.origin}/admin/import/blogs`,
        {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ domain, module, count, startId: startID }),
        }
      );
      document.getElementById("loader").classList.add("hidden");
      document.getElementById("warning-msg").classList.add("hidden");
      document.getElementById("form").classList.remove("hidden");
      const result = await response.json();

      if (response.status == 201 || response.status == 200) {
        document.getElementById("success").classList.remove("hidden");
        document.getElementById("success-msg").innerText = result?.query;
        document.getElementById(
          "lastdata-id"
        ).innerText = `Last Entered ID: ${result?.last_id}`;
        setTimeout(() => {
          document.getElementById("success").classList.add("hidden");
        }, 3000);
      } else if (response.status == 404) {
        document.getElementById("error").classList.remove("hidden");
        document.getElementById("error-msg").innerText = result?.err;
        setTimeout(() => {
          document.getElementById("error").classList.add("hidden");
        }, 3000);
      } else {
        document.getElementById("error").classList.remove("hidden");
        document.getElementById("error-msg").innerText =
          "Query Run Failed, Something Went Wrong!";
        setTimeout(() => {
          document.getElementById("error").classList.add("hidden");
        }, 3000);
      }
    } catch (error) {
      document.getElementById("error").classList.remove("hidden");
      document.getElementById("error-msg").innerText =
        "Query Run Failed, Something Went Wrong!";
      setTimeout(() => {
        document.getElementById("error").classList.add("hidden");
      }, 3000);
    }
  });
</script>

<%- include('../wrapper/footer') %>
