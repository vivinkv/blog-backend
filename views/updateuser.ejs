<%- include('wrapper/header') %>
<div class="flex items-center justify-center min-h-screen">
    <div
      class="w-full max-w-3xl p-6"
      data-aos="zoom-in"
      data-aos-duration="2000"
      data-aos-delay="500"
    >
      <form id="updateForm" class="bg-[#ffffff] rounded-lg shadow-lg p-8 space-y-4">
        <div class="flex justify-center mb-2">
          <img src="/profile.png" alt="User Icon" class="h-28 w-28" />
        </div>
        <div class="mb-4  flex flex-col md:flex-row md:space-x-4">
        <!-- Name Field -->
        <div class="mb-4 flex-1">
          <label for="name" class="block text-lg font-medium mb-2">Name</label>
          <div class="relative">
            <input
              type="text"
              id="name"
              placeholder="Enter Your Name"
              value="<%= data.name %>"
              required
              class="w-full px-4 py-2 bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
            <img
              src="/user.png"
              class="absolute right-2 top-3 h-5 w-5"
              alt="user"
            />
          </div>
        </div>

        <!-- Email Field -->
        <div class="mb-4 flex-1">
          <label for="email" class="block text-lg font-medium mb-2">Email</label>
          <div class="relative">
            <input
              type="email"
              id="email"
              value="<%= data.email %>"
              required
              placeholder="Enter Your Email"
              class="w-full px-4 py-2 bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            />
            <img
              src="/mail.png"
              class="absolute right-2 top-3 h-5 w-5"
              alt="mail"
            />
          </div>
          <small id="emailError" class="text-red-500 mt-2 hidden">
            * Wrong Email
          </small>
        </div>
        </div>


        <!-- Phone and Role Fields -->
        <div class="mb-4 flex flex-col md:flex-row md:space-x-4">
          <!-- Phone Number Field -->
          <div class="flex-1 mb-4 md:mb-0">
            <label for="phone" class="block text-lg font-medium mb-2">Phone Number</label>
            <div class="relative">
              <input
                type="tel"
                id="phone"
                value="<%= data.phone %>"
                required
                placeholder="Enter Your Phone Number"
                class="w-full px-4 py-2 bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
              <input type="hidden" name="id" id="id" value="<%= data.id %>">
              <img
                src="/phone.png"
                class="absolute right-2 top-3 h-5 w-5"
                alt="phone"
              />
              <small id="phoneError" class="text-red-500 mt-2 hidden">
                * Invalid Mobile
              </small>
            </div>
          </div>

          <!-- Role Dropdown -->
          <div class="flex-1">
            <label for="role" class="block text-lg font-medium mb-2">Role</label>
            <select
              id="role"
              required
              class="w-full px-4 py-2 bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            >
              <option value="" disabled>Select Your Role</option>
              <option value="user" <% if (data.role === 'user') { %> selected <% } %>>User</option>
              <option value="editor" <% if (data.role === 'editor') { %> selected <% } %>>Editor</option>
              <option value="author" <% if (data.role === 'author') { %> selected <% } %>>Author</option>
              <option value="seo" <% if (data.role === 'seo') { %> selected <% } %>>SEO</option>
            </select>
          </div>
        </div>

        <!-- Bio Textarea -->
        <div class="mb-4">
          <label for="bio" class="block text-lg font-medium mb-2">Bio</label>
          <textarea
            id="bio"
            rows="4"
            placeholder="Tell us about yourself"
            class="w-full px-4 py-2 bg-gray-50 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
          ><%= data.bio %></textarea>
          <small id="bioError" class="text-red-500 mt-2 hidden">
            * Bio Error
          </small>
        </div>

        <!-- Submit Button -->
        <button
          type="submit"
          class="w-full py-2 bg-[#3294de] text-md hover:bg-[#2178c0] rounded-lg font-semibold text-white"
        >
          Update Account
        </button>
      </form>
    </div>
  </div>


  
<script>
  // JavaScript to handle error display
  document
    .getElementById("updateForm")
    .addEventListener("submit", async function (event) {
      event.preventDefault(); // Prevent default form submission
        console.log('working');
      const name = document.getElementById("name").value;
      const email = document.getElementById("email").value;
      const role = document.getElementById("role").value;
      const phone = document.getElementById("phone").value;
      const bio = document.getElementById("bio").value;
      const id=document.getElementById('id').value;
      console.log(name);
      try {
        const sendData = await fetch(`${window.location.origin}/admin/dashboard/user/update/${id}`, {
        method: "PUT",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify({ name, email,role,phone,bio }),
      });
      const response = await sendData.json();

      console.log(response);

      if (response?.type == "email") {
        document.getElementById("emailError").innerText = `* ${response.err}`;
        document.getElementById("emailError").classList.remove("hidden");
        document.getElementById("phoneError").classList.add("hidden");
        return;
      
      } else if (response?.type == "phone") {
        document.getElementById(
          "phoneError"
        ).innerText = `* ${response.err}`;
        document.getElementById("emailError").classList.add("hidden");
        document.getElementById("phoneError").classList.remove("hidden");
        return;
      }
      if (response?.err) {
        document.getElementById(
          "bioError"
        ).innerText = `* ${response.err}`;
        document.getElementById("emailError").classList.add("hidden");
        document.getElementById("bioError").classList.remove("hidden");
        return;
      }
      window.location.href = '/admin/dashboard';
      } catch (error) {
        console.log(error);
      }
     
   
    });
</script>
<%- include('wrapper/footer') %>
